<!--pages/study/index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card">
    <view class="stats-bg"></view>
    <view class="stats-content">
      <view class="stats-main">
        <view class="stats-item-large">
          <text class="stats-num-large">{{studyStats.totalHours || 0}}</text>
          <text class="stats-label-large">æ€»å­¦ä¹ æ—¶é•¿(å°æ—¶)</text>
        </view>
        <view class="stats-divider"></view>
        <view class="stats-item-large">
          <text class="stats-num-large">{{studyStats.totalCourses || 0}}</text>
          <text class="stats-label-large">å·²å­¦è¯¾ç¨‹</text>
        </view>
      </view>
      <view class="stats-sub">
        <view class="stats-sub-item">
          <text class="sub-num">{{studyStats.todayHours || 0}}</text>
          <text class="sub-label">ä»Šæ—¥å­¦ä¹ (å°æ—¶)</text>
        </view>
        <view class="stats-sub-item">
          <text class="sub-num">{{studyStats.continuousDays || 0}}</text>
          <text class="sub-label">è¿ç»­å­¦ä¹ (å¤©)</text>
        </view>
        <view class="stats-sub-item">
          <text class="sub-num">{{studyStats.completedCourses || 0}}</text>
          <text class="sub-label">å·²å®Œæˆè¯¾ç¨‹</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å­¦ä¹ æ—¥å† -->
  <view class="calendar-section">
    <view class="section-header">
      <text class="section-title">å­¦ä¹ æ—¥å†</text>
      <text class="section-more" bindtap="onCalendarTap">æŸ¥çœ‹è¯¦æƒ… ></text>
    </view>
    <view class="calendar-content">
      <view class="week-row">
        <text class="week-item" wx:for="{{weekDays}}" wx:key="index">{{item}}</text>
      </view>
      <view class="day-row">
        <view class="day-item {{item.isToday ? 'today' : ''}} {{item.hasStudy ? 'studied' : ''}} {{item.isCurrentMonth ? '' : 'other-month'}}" 
              wx:for="{{calendarDays}}" 
              wx:key="date">
          <text class="day-num">{{item.day}}</text>
          <view class="study-dot" wx:if="{{item.hasStudy}}"></view>
        </view>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘å­¦ä¹  -->
  <view class="recent-section">
    <view class="section-header">
      <text class="section-title">æœ€è¿‘å­¦ä¹ </text>
      <text class="section-more" bindtap="onAllCourseTap">å…¨éƒ¨è¯¾ç¨‹ ></text>
    </view>
    <view class="course-list">
      <view class="course-item" wx:for="{{recentCourses}}" wx:key="id" data-id="{{item.id}}" bindtap="onCourseTap">
        <image class="course-cover" src="{{item.cover || '/images/course-default.png'}}" mode="aspectFill" lazy-load="{{true}}" />
        <view class="course-info">
          <text class="course-title">{{item.title}}</text>
          <text class="course-chapter">{{item.currentChapter || 'ç¬¬1ç«  è¯¾ç¨‹ä»‹ç»'}}</text>
          <view class="progress-wrap">
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{item.progress || 0}}%"></view>
            </view>
            <text class="progress-text">å·²å­¦{{item.progress || 0}}%</text>
          </view>
          <view class="course-bottom">
            <text class="last-study">ä¸Šæ¬¡å­¦ä¹ : {{item.lastStudyTime || 'ä»Šå¤©'}}</text>
            <view class="continue-btn" catchtap="onContinueTap" data-id="{{item.id}}">ç»§ç»­å­¦ä¹ </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && recentCourses.length === 0}}">
      <image class="empty-icon" src="/images/empty-study.png" mode="aspectFit" />
      <text class="empty-text">è¿˜æ²¡æœ‰å­¦ä¹ è®°å½•</text>
      <text class="empty-tip">å¿«å»å‘ç°æ„Ÿå…´è¶£çš„è¯¾ç¨‹å§</text>
      <view class="go-study-btn" bindtap="onGoStudyTap">å»å­¦ä¹ </view>
    </view>
  </view>

  <!-- å­¦ä¹ è®¡åˆ’ -->
  <view class="plan-section" wx:if="{{studyPlans.length > 0}}">
    <view class="section-header">
      <text class="section-title">å­¦ä¹ è®¡åˆ’</text>
      <text class="section-more" bindtap="onPlanTap">ç®¡ç† ></text>
    </view>
    <view class="plan-list">
      <view class="plan-item" wx:for="{{studyPlans}}" wx:key="id">
        <view class="plan-icon-wrap">
          <text class="plan-icon">ğŸ“…</text>
        </view>
        <view class="plan-info">
          <text class="plan-title">{{item.title}}</text>
          <text class="plan-desc">{{item.description}}</text>
        </view>
        <view class="plan-status {{item.status === 'completed' ? 'completed' : ''}}">
          {{item.status === 'completed' ? 'å·²å®Œæˆ' : 'è¿›è¡Œä¸­'}}
        </view>
      </view>
    </view>
  </view>

  <!-- å­¦ä¹ æ’è¡Œæ¦œ -->
  <view class="rank-section">
    <view class="section-header">
      <text class="section-title">å­¦ä¹ æ’è¡Œ</text>
      <text class="section-more" bindtap="onRankTap">æŸ¥çœ‹å…¨éƒ¨ ></text>
    </view>
    <view class="rank-list">
      <view class="rank-item {{index < 3 ? 'top' : ''}}" wx:for="{{rankList}}" wx:key="id">
        <view class="rank-num {{index < 3 ? 'top-num' : ''}}">{{index + 1}}</view>
        <image class="rank-avatar" src="{{item.avatar || '/images/avatar-default.png'}}" mode="aspectFill" />
        <text class="rank-name">{{item.nickname}}</text>
        <text class="rank-hours">{{item.studyHours}}å°æ—¶</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area"></view>
</view>
